SET TERM ^ ;

create or alter procedure SP_DEL_TP (
    ID_ORGANIZACAO varchar(36),
    ID_TITULO_PAGAR varchar(36))
as
declare variable ID_ORG varchar(36);
declare variable ID_TP varchar(36);
declare variable ID_TPB varchar(36);
begin
 ID_ORG = :ID_ORGANIZACAO;
 ID_TP  = :ID_TITULO_PAGAR;
 SELECT FIRST 1 TPB.ID_TITULO_PAGAR_BAIXA FROM TITULO_PAGAR_BAIXA TPB WHERE TPB.ID_TITULO_PAGAR = :ID_TP AND TPB.ID_ORGANIZACAO = :ID_ORG INTO :ID_TPB;

 --DELETAR A PARTE DE RATEIOS
 --- HISTORICO E CENTRO DE CUSTOS
 
DELETE FROM  titulo_pagar_historico TPH WHERE TPH.id_titulo_pagar = :ID_TP  AND TPH.ID_ORGANIZACAO = :ID_ORG ;
DELETE FROM  titulo_pagar_rateio_cc TPC WHERE TPC.id_titulo_pagar = :ID_TP  AND TPC.ID_ORGANIZACAO = :ID_ORG ;

--ACRESCIMOS E DEDUÇÕES

DELETE FROM titulo_pagar_baixa_ac TPBAC WHERE  TPBAC.id_titulo_pagar_baixa    = :ID_TPB  AND TPBAC.ID_ORGANIZACAO = :ID_ORG ;
DELETE FROM titulo_pagar_baixa_de TPBDE  WHERE  TPBDE.id_titulo_pagar_baixa    = :ID_TPB  AND TPBDE.ID_ORGANIZACAO = :ID_ORG ;

DELETE FROM titulo_pagar_baixa_cheque TPBC   WHERE TPBC.id_titulo_pagar_baixa  = :ID_TPB;
DELETE FROM titulo_pagar_baixa_internet TPBI WHERE TPBI.id_titulo_pagar_baixa  = :ID_TPB;
DELETE FROM tesouraria_debito TD             WHERE TD.id_titulo_pagar_baixa    = :ID_TPB;
DELETE FROM conta_bancaria_debito CBD        WHERE CBD.id_titulo_pagar         = :ID_TP;

DELETE FROM titulo_pagar_baixa_fp TPBFP      WHERE TPBFP.id_titulo_pagar_baixa =:ID_TPB;

DELETE FROM TITULO_PAGAR_BAIXA TPB           WHERE TPB.id_titulo_pagar         =:ID_TP AND TPB.ID_ORGANIZACAO = :ID_ORG ;
DELETE FROM TITULO_PAGAR TP                  WHERE TP.id_titulo_pagar          =:ID_TP AND TP.ID_ORGANIZACAO = :ID_ORG ;


end